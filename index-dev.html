<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Scala.js Tutorial</title>
</head>
<body>
<div>
    ID:
    <span id="peerId"></span>
</div>
<label for="source-code-area">Source Code</label><textarea id="source-code-area" style="display: block"
                                                           oninput="sourceCodeChange()"></textarea>
<label for="remote-peer-id">Remote ID</label><input type="text" id="remote-peer-id"/>
<button onclick="connectRemotePeer()">Connect</button>
<script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
<script>
    const peerIdSpan = document.getElementById('peerId');
    const remoteSpan = document.getElementById('remote-peer-id');

    const peer = new Peer();
    const connections = [];
    peer.on('open', (id) => peerIdSpan.textContent = id);
    peer.on('connection', (connection) => connection.on('data', (data) => receiveRemoteUpdate(data)));

    function connectRemotePeer() {
        const remoteId = remoteSpan.value.trim();
        remoteSpan.value = '';
        if (remoteId.length === 0) return;
        const connection = peer.connect(remoteId);
        connection.on('open', () => connections.push(connection))
    }

    function publish(data) {
        connections.forEach((connection) => connection.send(data));
    }
</script>
<!-- Include Scala.js compiled code -->
<script type="text/javascript" src="./target/scala-2.13/scala-js-tutorial-fastopt/main.js"></script>
</body>
</html>